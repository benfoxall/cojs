<li class="cell">
  <textarea class="input" ref:editor>{{code}}</textarea>
  <!-- <div ref:editor class="input" contenteditable >{{cell.code}}</div> -->
  <div ref:output class="output" style="color: {{error?'#c00':''}}">{{output}}</div>
</li>


<script>
export default {
  data() {
    return {
      code: '',
      output: ''
    }
  },

  oncreate () {

    this.set({code: this.get('cell').code})
    this.set({output: this.get('cell').output})


    const editable = this.refs.editor

    let lastValue
    const listener = (e) => {

      if(lastValue == editable.value) return

      console.log("LISTNEER FIRED", e)

      this.fire('update',
        {
          code: editable.value,
          ref: this.get('cell').ref
        }
      )

    }

    this.get('cell').addOutputListener((err, output) => {
      this.set({
        error: !!err,
        output: err || output
      })

    })

    // editable.addEventListener("DOMNodeInserted", listener, false)
    // editable.addEventListener("DOMNodeRemoved", listener, false)
    // editable.addEventListener("DOMCharacterDataModified", listener, false)


    editable.addEventListener("keydown", listener, false)
    editable.addEventListener("keyup", listener, false)
    editable.addEventListener("change", listener, false)

  }
}
</script>
